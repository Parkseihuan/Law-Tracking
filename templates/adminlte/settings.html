{% extends "adminlte/base.html" %}

{% block title %}ì‹œìŠ¤í…œ ì„¤ì • - ë²•ë ¹ ì¶”ì  ì‹œìŠ¤í…œ{% endblock %}
{% block page_title %}ì‹œìŠ¤í…œ ì„¤ì •{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="/">í™ˆ</a></li>
<li class="breadcrumb-item active">ì‹œìŠ¤í…œ ì„¤ì •</li>
{% endblock %}

{% block content %}
<div class="row">
    <!-- API ì„¤ì • -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-key mr-1"></i>
                    API ì„¤ì •
                </h3>
            </div>
            <div class="card-body">
                <form id="api-form">
                    <div class="form-group">
                        <label for="api-key">API í‚¤</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="api-key" value="psh@yi.ac.kr" readonly>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" onclick="toggleApiKey()">
                                    <i class="fas fa-eye" id="eye-icon"></i>
                                </button>
                            </div>
                        </div>
                        <small class="form-text text-muted">êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„° Open API í‚¤ (.env íŒŒì¼ì—ì„œ ì„¤ì •)</small>
                    </div>

                    <div class="form-group">
                        <label>API ìƒíƒœ</label>
                        <div id="api-status" class="alert alert-info">
                            <i class="fas fa-spinner fa-spin"></i> API ì—°ê²° í™•ì¸ ì¤‘...
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="testApiConnection()">
                        <i class="fas fa-vial"></i> API ì—°ê²° í…ŒìŠ¤íŠ¸
                    </button>
                </form>
            </div>
        </div>

        <!-- ìŠ¤ì¼€ì¤„ ì„¤ì • (Cloud Scheduler) -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-calendar-alt mr-1"></i>
                    ìë™ ì²´í¬ ìŠ¤ì¼€ì¤„
                </h3>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Cloud Run ë°°í¬ ì‹œ:</strong> Google Cloud Schedulerë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ë²•ë ¹ ë³€ê²½ì‚¬í•­ì„ ì²´í¬í•©ë‹ˆë‹¤.
                </div>

                <div class="form-group">
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="schedule-enabled">
                        <label class="custom-control-label" for="schedule-enabled">ìŠ¤ì¼€ì¤„ í™œì„±í™”</label>
                    </div>
                    <small class="form-text text-muted">Cloud Run ë°°í¬ í›„ í™œì„±í™”í•˜ì„¸ìš”</small>
                </div>

                <div class="form-group">
                    <label for="cron-expression">Cron í‘œí˜„ì‹</label>
                    <select class="form-control" id="cron-expression" onchange="updateCronDescription()">
                        <option value="0 */1 * * *">ë§¤ 1ì‹œê°„ë§ˆë‹¤</option>
                        <option value="0 */6 * * *">ë§¤ 6ì‹œê°„ë§ˆë‹¤</option>
                        <option value="0 */12 * * *">ë§¤ 12ì‹œê°„ë§ˆë‹¤</option>
                        <option value="0 9 * * *" selected>ë§¤ì¼ ì˜¤ì „ 9ì‹œ</option>
                        <option value="0 9,18 * * *">ë§¤ì¼ ì˜¤ì „ 9ì‹œ, ì˜¤í›„ 6ì‹œ</option>
                        <option value="0 9 * * 1-5">í‰ì¼ ì˜¤ì „ 9ì‹œ</option>
                        <option value="0 9 * * 1">ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ</option>
                    </select>
                    <small class="form-text text-muted" id="cron-description">ë§¤ì¼ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰</small>
                </div>

                <div class="form-group">
                    <label for="timezone">ì‹œê°„ëŒ€</label>
                    <select class="form-control" id="timezone">
                        <option value="Asia/Seoul" selected>í•œêµ­ í‘œì¤€ì‹œ (KST)</option>
                        <option value="UTC">í˜‘ì • ì„¸ê³„ì‹œ (UTC)</option>
                        <option value="America/New_York">ë¯¸êµ­ ë™ë¶€ (EST)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ë§ˆì§€ë§‰ ì‹¤í–‰</label>
                    <p class="form-control-static text-muted" id="last-run">-</p>
                </div>

                <button type="button" class="btn btn-success" onclick="saveScheduleSettings()">
                    <i class="fas fa-save"></i> ìŠ¤ì¼€ì¤„ ì €ì¥
                </button>
                <button type="button" class="btn btn-primary ml-2" onclick="manualCheck()">
                    <i class="fas fa-sync"></i> ìˆ˜ë™ ì²´í¬
                </button>
            </div>
        </div>
    </div>

    <!-- ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-envelope mr-1"></i>
                    ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •
                </h3>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>ì£¼ì˜:</strong> Gmail ì‚¬ìš© ì‹œ ì•± ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”.
                    <a href="https://myaccount.google.com/apppasswords" target="_blank">ì•± ë¹„ë°€ë²ˆí˜¸ ìƒì„±</a>
                </div>

                <div class="form-group">
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="email-enabled">
                        <label class="custom-control-label" for="email-enabled">ì´ë©”ì¼ ì•Œë¦¼ í™œì„±í™”</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="smtp-server">SMTP ì„œë²„</label>
                    <input type="text" class="form-control" id="smtp-server" placeholder="smtp.gmail.com">
                    <small class="form-text text-muted">Gmail: smtp.gmail.com, Naver: smtp.naver.com</small>
                </div>

                <div class="form-group">
                    <label for="smtp-port">SMTP í¬íŠ¸</label>
                    <input type="number" class="form-control" id="smtp-port" value="587">
                </div>

                <div class="form-group">
                    <label for="smtp-username">SMTP ì‚¬ìš©ìëª… (ì´ë©”ì¼)</label>
                    <input type="email" class="form-control" id="smtp-username" placeholder="your-email@gmail.com">
                </div>

                <div class="form-group">
                    <label for="smtp-password">SMTP ë¹„ë°€ë²ˆí˜¸</label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="smtp-password" placeholder="ì•± ë¹„ë°€ë²ˆí˜¸">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" onclick="toggleSmtpPassword()">
                                <i class="fas fa-eye" id="smtp-eye-icon"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email-sender">ë°œì‹ ì ì´ë©”ì¼</label>
                    <input type="email" class="form-control" id="email-sender" placeholder="your-email@gmail.com">
                    <small class="form-text text-muted">ë¹„ì›Œë‘ë©´ SMTP ì‚¬ìš©ìëª…ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •ë©ë‹ˆë‹¤</small>
                </div>

                <div class="form-group">
                    <label for="email-recipients">ìˆ˜ì‹ ì ì´ë©”ì¼ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <input type="text" class="form-control" id="email-recipients"
                           placeholder="email1@example.com, email2@example.com">
                </div>

                <button type="button" class="btn btn-success" onclick="saveEmailSettings()">
                    <i class="fas fa-save"></i> ì´ë©”ì¼ ì„¤ì • ì €ì¥
                </button>
                <button type="button" class="btn btn-info ml-2" onclick="testEmailConnection()">
                    <i class="fas fa-vial"></i> ì—°ê²° í…ŒìŠ¤íŠ¸
                </button>

                <div id="email-test-result" class="mt-3" style="display:none;"></div>
            </div>
        </div>

        <!-- ë°ì´í„° ê´€ë¦¬ -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-database mr-1"></i>
                    ë°ì´í„° ê´€ë¦¬
                </h3>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="info-box">
                            <span class="info-box-icon bg-info"><i class="fas fa-gavel"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">ì¶”ì  ì¤‘ì¸ ë²•ë ¹</span>
                                <span class="info-box-number" id="total-laws">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-box">
                            <span class="info-box-icon bg-warning"><i class="fas fa-history"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">ì´ë ¥ íŒŒì¼</span>
                                <span class="info-box-number" id="history-files">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="btn-group-vertical btn-block" role="group">
                    <button type="button" class="btn btn-success" onclick="exportData()">
                        <i class="fas fa-download"></i> ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)
                    </button>
                    <button type="button" class="btn btn-warning" onclick="clearCache()">
                        <i class="fas fa-trash"></i> ìºì‹œ ì‚­ì œ
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmClearAllData()">
                        <i class="fas fa-exclamation-triangle"></i> ëª¨ë“  ë°ì´í„° ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>

        <!-- ì‹œìŠ¤í…œ ì •ë³´ -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-info-circle mr-1"></i>
                    ì‹œìŠ¤í…œ ì •ë³´
                </h3>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">ë²„ì „</dt>
                    <dd class="col-sm-8">1.0.0</dd>

                    <dt class="col-sm-4">í”„ë ˆì„ì›Œí¬</dt>
                    <dd class="col-sm-8">Flask + AdminLTE</dd>

                    <dt class="col-sm-4">API ì œê³µ</dt>
                    <dd class="col-sm-8">êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°</dd>

                    <dt class="col-sm-4">ë¸Œë¼ìš°ì €</dt>
                    <dd class="col-sm-8" id="browser-info">-</dd>

                    <dt class="col-sm-4">í™”ë©´ í•´ìƒë„</dt>
                    <dd class="col-sm-8" id="screen-info">-</dd>
                </dl>

                <a href="https://github.com/YOUR_USERNAME/Law-Tracking" target="_blank" class="btn btn-dark btn-block">
                    <i class="fab fa-github"></i> GitHub ì €ì¥ì†Œ
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
$(document).ready(function() {
    checkApiStatus();
    loadDataStats();
    loadSystemInfo();
    loadScheduleSettings();
    loadEmailSettings();
});

// API í‚¤ í† ê¸€
function toggleApiKey() {
    const input = document.getElementById('api-key');
    const icon = document.getElementById('eye-icon');

    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// API ìƒíƒœ í™•ì¸
function checkApiStatus() {
    fetch('/api/statistics')
        .then(response => response.json())
        .then(data => {
            document.getElementById('api-status').innerHTML = `
                <i class="fas fa-check-circle text-success"></i>
                <strong>API ì—°ê²° ì •ìƒ</strong><br>
                <small>ì¶”ì  ì¤‘ì¸ ë²•ë ¹: ${data.total_laws}ê°œ</small>
            `;
        })
        .catch(err => {
            document.getElementById('api-status').innerHTML = `
                <i class="fas fa-times-circle text-danger"></i>
                <strong>API ì—°ê²° ì‹¤íŒ¨</strong><br>
                <small>${err.message}</small>
            `;
        });
}

// API ì—°ê²° í…ŒìŠ¤íŠ¸
function testApiConnection() {
    const statusDiv = document.getElementById('api-status');
    statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> í…ŒìŠ¤íŠ¸ ì¤‘...';

    fetch('/api/statistics')
        .then(response => response.json())
        .then(data => {
            statusDiv.className = 'alert alert-success';
            statusDiv.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <strong>API ì—°ê²° ì„±ê³µ!</strong><br>
                <small>ì¶”ì  ì¤‘ì¸ ë²•ë ¹: ${data.total_laws}ê°œ</small>
            `;
        })
        .catch(err => {
            statusDiv.className = 'alert alert-danger';
            statusDiv.innerHTML = `
                <i class="fas fa-times-circle"></i>
                <strong>ì—°ê²° ì‹¤íŒ¨</strong><br>
                <small>${err.message}</small>
            `;
        });
}

// ==================== ìŠ¤ì¼€ì¤„ ì„¤ì • ====================

// ìŠ¤ì¼€ì¤„ ì„¤ì • ë¡œë“œ
function loadScheduleSettings() {
    fetch('/api/config/schedule')
        .then(response => response.json())
        .then(data => {
            document.getElementById('schedule-enabled').checked = data.enabled || false;
            document.getElementById('cron-expression').value = data.cron || '0 9 * * *';
            document.getElementById('timezone').value = data.timezone || 'Asia/Seoul';

            if (data.last_run) {
                const lastRun = new Date(data.last_run);
                document.getElementById('last-run').textContent =
                    lastRun.toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'});
            }

            updateCronDescription();
        })
        .catch(err => console.error('ìŠ¤ì¼€ì¤„ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', err));
}

// Cron ì„¤ëª… ì—…ë°ì´íŠ¸
function updateCronDescription() {
    const cron = document.getElementById('cron-expression').value;
    const descriptions = {
        '0 */1 * * *': 'ë§¤ 1ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰',
        '0 */6 * * *': 'ë§¤ 6ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰',
        '0 */12 * * *': 'ë§¤ 12ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰',
        '0 9 * * *': 'ë§¤ì¼ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰',
        '0 9,18 * * *': 'ë§¤ì¼ ì˜¤ì „ 9ì‹œ, ì˜¤í›„ 6ì‹œì— ì‹¤í–‰',
        '0 9 * * 1-5': 'í‰ì¼ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰',
        '0 9 * * 1': 'ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰'
    };
    document.getElementById('cron-description').textContent =
        descriptions[cron] || 'Cron í‘œí˜„ì‹: ' + cron;
}

// ìŠ¤ì¼€ì¤„ ì„¤ì • ì €ì¥
function saveScheduleSettings() {
    const scheduleData = {
        enabled: document.getElementById('schedule-enabled').checked,
        cron: document.getElementById('cron-expression').value,
        timezone: document.getElementById('timezone').value
    };

    fetch('/api/config/schedule', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(scheduleData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('âœ… ìŠ¤ì¼€ì¤„ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nCloud Run ë°°í¬ ì‹œ Google Cloud Schedulerë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.');
            loadScheduleSettings();
        } else {
            alert('âŒ ì €ì¥ ì‹¤íŒ¨: ' + data.message);
        }
    })
    .catch(err => {
        console.error('ìŠ¤ì¼€ì¤„ ì €ì¥ ì‹¤íŒ¨:', err);
        alert('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ìˆ˜ë™ ì²´í¬ ì‹¤í–‰
function manualCheck() {
    if (!confirm('ìˆ˜ë™ìœ¼ë¡œ ë²•ë ¹ ë³€ê²½ì‚¬í•­ì„ ì²´í¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }

    const btn = event.target;
    const originalHtml = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì²´í¬ ì¤‘...';

    fetch('/api/check-updates', {method: 'POST'})
        .then(response => response.json())
        .then(data => {
            btn.disabled = false;
            btn.innerHTML = originalHtml;

            if (data.success) {
                let message = `âœ… ì²´í¬ ì™„ë£Œ!\n\në³€ê²½ì‚¬í•­: ${data.updated}ê±´`;
                if (data.notifications) {
                    if (data.notifications.email) {
                        message += '\nğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ';
                    }
                }
                alert(message);
                loadScheduleSettings();
            } else {
                alert('âŒ ì²´í¬ ì‹¤íŒ¨: ' + data.error);
            }
        })
        .catch(err => {
            btn.disabled = false;
            btn.innerHTML = originalHtml;
            console.error('ì²´í¬ ì‹¤íŒ¨:', err);
            alert('âŒ ì²´í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
}

// ==================== ì´ë©”ì¼ ì„¤ì • ====================

// ì´ë©”ì¼ ì„¤ì • ë¡œë“œ
function loadEmailSettings() {
    fetch('/api/config/email')
        .then(response => response.json())
        .then(data => {
            document.getElementById('email-enabled').checked = data.enabled || false;
            document.getElementById('smtp-server').value = data.smtp_server || '';
            document.getElementById('smtp-port').value = data.smtp_port || 587;
            document.getElementById('smtp-username').value = data.smtp_username || '';
            document.getElementById('smtp-password').value = data.smtp_password || '';
            document.getElementById('email-sender').value = data.sender || '';

            if (data.recipients && Array.isArray(data.recipients)) {
                document.getElementById('email-recipients').value = data.recipients.join(', ');
            }
        })
        .catch(err => console.error('ì´ë©”ì¼ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', err));
}

// SMTP ë¹„ë°€ë²ˆí˜¸ í† ê¸€
function toggleSmtpPassword() {
    const input = document.getElementById('smtp-password');
    const icon = document.getElementById('smtp-eye-icon');

    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// ì´ë©”ì¼ ì„¤ì • ì €ì¥
function saveEmailSettings() {
    const recipientsText = document.getElementById('email-recipients').value;
    const recipients = recipientsText.split(',').map(email => email.trim()).filter(email => email);

    const emailData = {
        enabled: document.getElementById('email-enabled').checked,
        smtp_server: document.getElementById('smtp-server').value,
        smtp_port: parseInt(document.getElementById('smtp-port').value),
        smtp_username: document.getElementById('smtp-username').value,
        smtp_password: document.getElementById('smtp-password').value,
        sender: document.getElementById('email-sender').value,
        recipients: recipients
    };

    fetch('/api/config/email', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(emailData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('âœ… ì´ë©”ì¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            loadEmailSettings();
        } else {
            alert('âŒ ì €ì¥ ì‹¤íŒ¨: ' + data.message);
        }
    })
    .catch(err => {
        console.error('ì´ë©”ì¼ ì €ì¥ ì‹¤íŒ¨:', err);
        alert('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ì´ë©”ì¼ ì—°ê²° í…ŒìŠ¤íŠ¸
function testEmailConnection() {
    const resultDiv = document.getElementById('email-test-result');
    resultDiv.style.display = 'block';
    resultDiv.className = 'alert alert-info mt-3';
    resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> SMTP ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';

    fetch('/api/config/email/test', {method: 'POST'})
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                resultDiv.className = 'alert alert-success mt-3';
                resultDiv.innerHTML = '<i class="fas fa-check-circle"></i> ' + data.message;
            } else {
                resultDiv.className = 'alert alert-danger mt-3';
                resultDiv.innerHTML = '<i class="fas fa-times-circle"></i> ' + data.message;
            }
        })
        .catch(err => {
            resultDiv.className = 'alert alert-danger mt-3';
            resultDiv.innerHTML = '<i class="fas fa-times-circle"></i> í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message;
        });
}

// ë°ì´í„° í†µê³„ ë¡œë“œ
function loadDataStats() {
    fetch('/api/statistics')
        .then(response => response.json())
        .then(data => {
            document.getElementById('total-laws').textContent = data.total_laws || 0;
            // ì´ë ¥ íŒŒì¼ ìˆ˜ëŠ” ë³„ë„ API í•„ìš”
            document.getElementById('history-files').textContent = '0';
        })
        .catch(err => console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', err));
}

// ì‹œìŠ¤í…œ ì •ë³´ ë¡œë“œ
function loadSystemInfo() {
    // ë¸Œë¼ìš°ì € ì •ë³´
    const browser = navigator.userAgent.match(/(firefox|msie|chrome|safari)[\/\s]([\d.]+)/gi);
    document.getElementById('browser-info').textContent = browser ? browser[0] : 'Unknown';

    // í™”ë©´ í•´ìƒë„
    document.getElementById('screen-info').textContent =
        `${window.screen.width} Ã— ${window.screen.height}`;
}

// ë°ì´í„° ë‚´ë³´ë‚´ê¸°
function exportData() {
    fetch('/api/laws')
        .then(response => response.json())
        .then(data => {
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `law_tracking_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            alert('ë°ì´í„°ê°€ ë‚´ë³´ë‚´ê¸°ë˜ì—ˆìŠµë‹ˆë‹¤!');
        })
        .catch(err => {
            console.error('ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', err);
            alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        });
}

// ìºì‹œ ì‚­ì œ
function clearCache() {
    if (confirm('ìºì‹œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ìºì‹œ ì‚­ì œ
        localStorage.removeItem('cachedLaws');
        localStorage.removeItem('cachedStats');

        alert('ìºì‹œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        location.reload();
    }
}

// ëª¨ë“  ë°ì´í„° ì‚­ì œ í™•ì¸
function confirmClearAllData() {
    if (confirm('âš ï¸ ê²½ê³ : ëª¨ë“  ì¶”ì  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤!\n\nì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        if (confirm('ì •ë§ í™•ì‹¤í•©ë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
            alert('ì´ ê¸°ëŠ¥ì€ ì„œë²„ ì¸¡ êµ¬í˜„ì´ í•„ìš”í•©ë‹ˆë‹¤.\ní˜„ì¬ëŠ” ìˆ˜ë™ìœ¼ë¡œ data/ í´ë”ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.');
        }
    }
}
</script>
{% endblock %}
